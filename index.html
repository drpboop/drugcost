
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>drug cost & accumulator calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Century+Gothic&display=swap');

    body {
      background-color: #000;
      color: #fff;
      font-family: 'Century Gothic', sans-serif;
      margin: 0;
      padding: 20px;
    }

    .container {
      background-color: #111;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 550px;
      margin: 0 auto;
      box-shadow: 0 0 10px rgba(255,255,255,0.2);
      box-sizing: border-box;
    }

    h2 {
      text-align: center;
      color: #7cc6ff;
      margin: 0 0 14px 0;
      font-weight: 700;
      font-size: 1.3em;
      text-transform: lowercase; /* ensure lowercase */
    }

    label, input, select {
      display: block;
      width: 100%;
      margin-bottom: 12px;
      background-color: #222;
      color: #fff;
      border: none;
      padding: 8px;
      border-radius: 5px;
      box-sizing: border-box;
      font-family: 'Century Gothic', sans-serif;
      text-transform: lowercase; /* visible text lowercase */
    }

    input::placeholder {
      color: #aaa;
      text-transform: lowercase;
    }

    .row-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .result-box {
      background-color: #222;
      padding: 14px;
      border-radius: 8px;
      margin-top: 15px;
      font-size: 1.05em;
      line-height: 1.6em;
      color: #d7eaff;
      text-align: center;      /* center all result lines */
    }

    .result-box strong {
      color: #ffffff;          /* bold, bright for emphasis */
      font-weight: 700;
    }

    button {
      background-color: #444;
      color: #fff;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      width: 100%;
      margin-top: 12px;
      font-family: 'Century Gothic', sans-serif;
      text-transform: lowercase;
    }

    button:hover {
      background-color: #666;
    }

    .error {
      color: #ff6b6b;
      font-size: 0.95em;
      margin-top: 6px;
      text-align: center;
      text-transform: lowercase;
    }
  </style>
</head>
<body>

  <div class="container">
    <h2>drug cost & accumulator calculator</h2>

    <!-- drug retail cost -->
    <label for="retail">drug retail cost ($):</label>
    <input type="number" id="retail" placeholder="example: 150.00" min="0" step="0.01" />

    <!-- member cost: select type then enter the number in one field -->
    <label for="costType">member cost type:</label>
    <select id="costType" onchange="onCostTypeChange()">
      <option value="">-- select an option --</option>
      <option value="copay">flat copay</option>
      <option value="coins">coinsurance %</option>
    </select>

    <label id="costValueLabel" for="costValue">enter amount:</label>
    <input type="number" id="costValue" placeholder="enter amount" min="0" step="0.01" disabled />

    <!-- accumulators FIRST, then current paid NEXT (per your request) -->
    <div class="row-2">
      <div>
        <label for="dedTotal">total deductible amount ($):</label>
        <input type="number" id="dedTotal" placeholder="example: 250" min="0" step="0.01" />
      </div>
      <div>
        <label for="dedPaid">current deductible paid ($):</label>
        <input type="number" id="dedPaid" placeholder="example: 100" min="0" step="0.01" />
      </div>
    </div>

    <div class="row-2">
      <div>
        <label for="oopTotal">total out-of-pocket max ($):</label>
        <input type="number" id="oopTotal" placeholder="example: 2000" min="0" step="0.01" />
      </div>
      <div>
        <label for="oopPaid">current out-of-pocket paid ($):</label>
        <input type="number" id="oopPaid" placeholder="(auto if blank)" min="0" step="0.01" />
      </div>
    </div>

    <button onclick="calcDrugCost()">calculate drug cost</button>

    <div id="errorBox" class="error" aria-live="polite"></div>

    <!-- results -->
    <div id="results" class="result-box">results will appear hereâ€¦</div>
  </div>

  <script>
    function fmt(n) {
      return (isFinite(n) ? n : 0).toFixed(2);
    }

    function onCostTypeChange() {
      const type = document.getElementById('costType').value;
      const costValue = document.getElementById('costValue');
      const label = document.getElementById('costValueLabel');

      if (!type) {
        label.textContent = 'enter amount:';
        costValue.placeholder = 'enter amount';
        costValue.value = '';
        costValue.disabled = true;
        return;
      }

      if (type === 'copay') {
        label.textContent = 'copay amount ($):';
        costValue.placeholder = 'example: 25.00';
        costValue.step = '0.01';
      } else {
        label.textContent = 'coinsurance %:';
        costValue.placeholder = 'example: 25';
        costValue.step = '0.01';
      }

      costValue.disabled = false;
      costValue.focus();
    }

    // auto-fill current oop paid when current deductible paid is entered (if oop is blank)
    document.addEventListener('DOMContentLoaded', () => {
      const dedPaidEl = document.getElementById('dedPaid');
      const oopPaidEl = document.getElementById('oopPaid');

      const maybeFillOOP = () => {
        if (oopPaidEl.value.trim() === '') {
          oopPaidEl.value = dedPaidEl.value.trim();
        }
      };

      dedPaidEl.addEventListener('input', maybeFillOOP);
      // also run once in case browser autofills
      maybeFillOOP();
    });

    function calcDrugCost() {
      const errorBox = document.getElementById('errorBox');
      errorBox.textContent = '';

      let retail = parseFloat(document.getElementById('retail').value) || 0;
      const type = document.getElementById('costType').value;
      let costValue = parseFloat(document.getElementById('costValue').value);

      const dedTotal = parseFloat(document.getElementById('dedTotal').value) || 0;
      const dedPaid = parseFloat(document.getElementById('dedPaid').value) || 0;
      const oopTotal = parseFloat(document.getElementById('oopTotal').value) || 0;
      const oopPaid = parseFloat(document.getElementById('oopPaid').value) || 0;

      // validations (lowercase messages)
      if (retail <= 0) {
        errorBox.textContent = 'please enter a valid drug retail cost.';
        document.getElementById('retail').focus();
        return;
      }
      if (!type) {
        errorBox.textContent = 'please select member cost type.';
        document.getElementById('costType').focus();
        return;
      }
      if (!isFinite(costValue) || costValue < 0) {
        errorBox.textContent = 'please enter a valid amount for the selected cost type.';
        document.getElementById('costValue').focus();
        return;
      }
      if (dedTotal < 0 || oopTotal < 0) {
        errorBox.textContent = 'please enter valid plan totals for deductible and oop.';
        return;
      }

      // clamp paid vs totals
      const safeDedPaid = Math.min(Math.max(dedPaid, 0), Math.max(dedTotal, 0));
      const safeOopPaid = Math.min(Math.max(oopPaid, 0), Math.max(oopTotal, 0));

      let remainingDedBefore = Math.max(dedTotal - safeDedPaid, 0);
      let remainingOOPBefore = Math.max(oopTotal - safeOopPaid, 0);

      // if oop already met, member pays $0
      if (safeOopPaid >= oopTotal) {
        renderResults({
          remainingDedBefore,
          remainingOOPBefore,
          memberCostFinal: 0,
          newDedPaid: safeDedPaid,
          newOOP: safeOopPaid
        });
        return;
      }

      // deductible applies first (your original logic)
      let dedApplied = 0;
      if (remainingDedBefore > 0) {
        dedApplied = Math.min(retail, remainingDedBefore);
      }

      let retailAfterDed = retail - dedApplied;

      // cost-sharing on remaining retail
      let costShare = 0;
      if (retailAfterDed > 0) {
        if (type === 'copay') {
          costShare = costValue;
        } else {
          costShare = retailAfterDed * (costValue / 100);
        }
      }

      // total member cost before oop cap
      let memberCostPreCap = dedApplied + costShare;

      // apply oop cap
      let remainingOOPAvail = Math.max(oopTotal - safeOopPaid, 0);
      let memberCostFinal = Math.min(memberCostPreCap, remainingOOPAvail);

      // update accumulators
      let newDedPaid = safeDedPaid + dedApplied;
      let newOOP = safeOopPaid + memberCostFinal;

      renderResults({
        remainingDedBefore,
        remainingOOPBefore,
        memberCostFinal,
        newDedPaid,
        newOOP,
        dedTotal,
        oopTotal
      });
    }

    function renderResults(data) {
      const {
        remainingDedBefore = 0,
        remainingOOPBefore = 0,
        memberCostFinal = 0,
        newDedPaid = 0,
        newOOP = 0,
        dedTotal = 0,
        oopTotal = 0
      } = data;

      const remainingDedAfterFill = Math.max(dedTotal - newDedPaid, 0);
      const remainingOOPAfterFill = Math.max(oopTotal - newOOP, 0);

      const lines = [
        `remaining deductible before fill: <strong>$${fmt(remainingDedBefore)}</strong>`,
        `remaining oop before fill: <strong>$${fmt(remainingOOPBefore)}</strong>`,
        ``,
        `member cost for this fill: <strong>$${fmt(memberCostFinal)}</strong>`,
        ``,
        `updated deductible after fill: <strong>$${fmt(newDedPaid)}</strong>`,
        `updated oop after fill: <strong>$${fmt(newOOP)}</strong>`,
        ``,
        remainingDedAfterFill > 0
          ? `remaining deductible after fill: <strong>$${fmt(remainingDedAfterFill)}</strong>`
          : `deductible satisfied`,
        remainingOOPAfterFill > 0
          ? `remaining oop after fill: <strong>$${fmt(remainingOOPAfterFill)}</strong>`
          : `oop satisfied`
      ];

      document.getElementById('results').innerHTML = lines.join('<br>');
    }
  </script>

</body>
</html>
